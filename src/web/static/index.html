<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Indexer Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">üìö Project Indexer</h1>
                        <p class="text-gray-600 mt-1">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞–º–∏</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <div class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</div>
                            <div class="text-lg font-semibold" :class="serverStatus === 'üü¢' ? 'text-green-600' : 'text-red-600'">
                                {{ serverStatus }} {{ serverStatus === 'üü¢' ? '–†–∞–±–æ—Ç–∞–µ—Ç' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
                    <div class="text-gray-500 text-sm font-medium">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
                    <div class="text-4xl font-bold text-blue-600 mt-2">{{ totalProjects }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
                    <div class="text-gray-500 text-sm font-medium">–§–∞–π–ª–æ–≤ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ</div>
                    <div class="text-4xl font-bold text-green-600 mt-2">{{ totalFiles }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 border-l-4 border-purple-500">
                    <div class="text-gray-500 text-sm font-medium">API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</div>
                    <div class="text-4xl font-bold text-purple-600 mt-2">6</div>
                </div>
            </div>

            <!-- Global Search -->
            <div v-if="projects.length > 0" class="bg-white rounded-lg shadow mb-6">
                <div class="p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üîç Semantic Search</h2>
                    <div class="flex gap-3">
                        <select
                            v-model="searchProjectPath"
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
                            <option v-for="project in projects" :key="project.project_path" :value="project.project_path">
                                {{ project.project_name }}
                            </option>
                        </select>
                        <input
                            v-model="globalSearchQuery"
                            @keyup.enter="performGlobalSearch"
                            type="text"
                            placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: NotificationSettings.kt)..."
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                            @click="performGlobalSearch"
                            :disabled="!globalSearchQuery || globalSearching"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <span v-if="globalSearching">‚è≥ –ü–æ–∏—Å–∫...</span>
                            <span v-else>–ù–∞–π—Ç–∏</span>
                        </button>
                    </div>

                    <!-- Search Results -->
                    <div v-if="searchResults.length > 0" class="mt-4 space-y-2">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm text-gray-600">
                                –ù–∞–π–¥–µ–Ω–æ: <span class="font-semibold">{{ searchResults.length }}</span> —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                            </p>
                            <button
                                @click="clearSearch"
                                class="text-sm text-gray-500 hover:text-gray-700"
                            >
                                ‚úï –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                        <div
                            v-for="result in searchResults"
                            :key="result.relative_path"
                            class="p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition cursor-pointer border border-gray-200"
                            @click="openSearchResult(result)"
                        >
                            <div class="flex items-start justify-between">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-2">
                                        <span class="font-mono text-sm font-semibold text-gray-800 truncate">
                                            {{ result.relative_path }}
                                        </span>
                                        <span class="px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded">
                                            {{ result.language }}
                                        </span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 line-clamp-2">{{ result.purpose || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}</p>
                                </div>
                                <div class="ml-4 text-right">
                                    <div class="text-sm font-semibold text-green-600">
                                        {{ (result.score * 100).toFixed(1) }}%
                                    </div>
                                    <div class="text-xs text-gray-500">similarity</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- No Results -->
                    <div v-if="searchPerformed && searchResults.length === 0" class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-sm text-yellow-800">
                            –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "<strong>{{ lastSearchQuery }}</strong>"
                        </p>
                    </div>
                </div>
            </div>

            <!-- Projects List -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-semibold text-gray-800">–ü—Ä–æ–µ–∫—Ç—ã</h2>
                        <button
                            @click="loadProjects"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                        >
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div v-if="loading" class="p-12 text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="text-gray-500 mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...</p>
                </div>

                <!-- Empty State -->
                <div v-else-if="projects.length === 0" class="p-12 text-center">
                    <div class="text-6xl mb-4">üìÇ</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
                    <p class="text-gray-500">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
                </div>

                <!-- Projects List -->
                <div v-else class="divide-y divide-gray-200">
                    <div
                        v-for="project in projects"
                        :key="project.collection_name"
                        class="p-6 hover:bg-gray-50 transition cursor-pointer"
                        @click="selectProject(project)"
                    >
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3">
                                    <h3 class="text-lg font-semibold text-gray-800">
                                        {{ project.project_name }}
                                    </h3>
                                    <span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded">
                                        {{ project.architecture_type }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">üìÅ {{ project.project_path }}</p>

                                <!-- Tech Stack -->
                                <div class="flex gap-2 mt-3 flex-wrap">
                                    <span
                                        v-for="tech in project.tech_stack.slice(0, 5)"
                                        :key="tech"
                                        class="px-3 py-1 text-xs bg-blue-100 text-blue-800 rounded-full font-medium"
                                    >
                                        {{ tech }}
                                    </span>
                                    <span
                                        v-if="project.tech_stack.length > 5"
                                        class="px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-full"
                                    >
                                        +{{ project.tech_stack.length - 5 }}
                                    </span>
                                </div>

                                <!-- Frameworks -->
                                <div v-if="project.frameworks.length > 0" class="flex gap-2 mt-2 flex-wrap">
                                    <span
                                        v-for="framework in project.frameworks.slice(0, 3)"
                                        :key="framework"
                                        class="px-3 py-1 text-xs bg-green-100 text-green-800 rounded-full"
                                    >
                                        üõ†Ô∏è {{ framework }}
                                    </span>
                                </div>
                            </div>

                            <div class="text-right ml-4">
                                <div class="text-2xl font-bold text-gray-700">
                                    {{ project.total_files }}
                                </div>
                                <div class="text-sm text-gray-500">—Ñ–∞–π–ª–æ–≤</div>
                                <div class="text-xs text-gray-400 mt-2">
                                    {{ formatDate(project.indexed_at) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Selected Project Details Modal -->
            <div v-if="selectedProject" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" @click="selectedProject = null">
                <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-auto" @click.stop>
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold text-gray-800">{{ selectedProject.project_name }}</h3>
                                <p class="text-gray-600 mt-1">{{ selectedProject.project_path }}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button
                                    @click="confirmDeleteProject"
                                    class="px-3 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                                    title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏–∑ –∏–Ω–¥–µ–∫—Å–∞"
                                >
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                                <button @click="selectedProject = null" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="border-b border-gray-200">
                        <div class="flex">
                            <button
                                @click="currentTab = 'info'"
                                :class="currentTab === 'info' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-6 border-b-2 font-medium text-sm"
                            >
                                üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                            </button>
                            <button
                                @click="currentTab = 'files'"
                                :class="currentTab === 'files' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-6 border-b-2 font-medium text-sm"
                            >
                                üìÅ –§–∞–π–ª—ã ({{ selectedProject.total_files }})
                            </button>
                            <button
                                @click="currentTab = 'callgraph'; loadCallGraphData()"
                                :class="currentTab === 'callgraph' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-6 border-b-2 font-medium text-sm"
                            >
                                üìä Call Graph
                            </button>
                        </div>
                    </div>

                    <div class="p-6">
                        <!-- Info Tab -->
                        <div v-if="currentTab === 'info'" class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h4>
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg">{{ selectedProject.architecture_type }}</span>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">Tech Stack</h4>
                                <div class="flex flex-wrap gap-2">
                                    <span v-for="tech in selectedProject.tech_stack" :key="tech"
                                          class="px-3 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm">
                                        {{ tech }}
                                    </span>
                                </div>
                            </div>

                            <div v-if="selectedProject.frameworks.length > 0">
                                <h4 class="font-semibold text-gray-700 mb-2">Frameworks</h4>
                                <div class="flex flex-wrap gap-2">
                                    <span v-for="framework in selectedProject.frameworks" :key="framework"
                                          class="px-3 py-1 bg-green-100 text-green-800 rounded-lg text-sm">
                                        {{ framework }}
                                    </span>
                                </div>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-700 mb-2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="text-sm text-gray-600">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</div>
                                        <div class="text-2xl font-bold text-gray-800">{{ selectedProject.total_files }}</div>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="text-sm text-gray-600">–î–∞—Ç–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏</div>
                                        <div class="text-lg font-semibold text-gray-800">{{ formatDate(selectedProject.indexed_at) }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Files Tab -->
                        <div v-if="currentTab === 'files'" class="space-y-4">
                            <!-- Loading -->
                            <div v-if="loadingFiles" class="text-center py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                                <p class="text-gray-500 mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...</p>
                            </div>

                            <!-- Files List -->
                            <div v-else>
                                <div class="mb-4 flex justify-between items-center">
                                    <p class="text-gray-600">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: <span class="font-semibold">{{ projectFiles.length }}</span></p>
                                    <input
                                        v-model="fileSearchQuery"
                                        type="text"
                                        placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞..."
                                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>

                                <div class="space-y-2 max-h-96 overflow-y-auto">
                                    <div
                                        v-for="file in filteredFiles"
                                        :key="file.relative_path"
                                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition"
                                    >
                                        <div
                                            @click="viewFileContent(file)"
                                            class="flex-1 min-w-0 cursor-pointer"
                                        >
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-700 font-mono text-sm truncate">
                                                    {{ file.relative_path }}
                                                </span>
                                                <span class="px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded">
                                                    {{ file.language }}
                                                </span>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1 truncate">{{ file.purpose }}</p>
                                        </div>
                                        <div class="flex items-center gap-3 ml-4">
                                            <span class="text-xs text-gray-500">
                                                {{ file.chunks }} {{ file.chunks === 1 ? '—á–∞–Ω–∫' : '—á–∞–Ω–∫–∞' }}
                                            </span>
                                            <span :class="getFileTypeColor(file.file_type)" class="px-2 py-1 text-xs rounded">
                                                {{ file.file_type }}
                                            </span>
                                            <button
                                                @click.stop="updateFileIndex(file)"
                                                class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition"
                                                title="–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å —Ñ–∞–π–ª–∞"
                                                :disabled="file.updating"
                                            >
                                                <span v-if="file.updating">‚è≥</span>
                                                <span v-else>üîÑ</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="filteredFiles.length === 0" class="text-center py-8 text-gray-500">
                                    –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                                </div>
                            </div>
                        </div>

                        <!-- Call Graph Tab -->
                        <div v-if="currentTab === 'callgraph'" class="space-y-6">
                            <!-- Loading -->
                            <div v-if="loadingCallGraph" class="text-center py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                                <p class="text-gray-500 mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ call graph...</p>
                            </div>

                            <!-- Call Graph Content -->
                            <div v-else-if="callGraphStats">
                                <!-- Stats Cards -->
                                <div class="grid grid-cols-4 gap-4">
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600">Functions</div>
                                        <div class="text-2xl font-bold text-blue-600">{{ callGraphStats.total_functions }}</div>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600">Calls</div>
                                        <div class="text-2xl font-bold text-green-600">{{ callGraphStats.total_calls }}</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600">Entry Points</div>
                                        <div class="text-2xl font-bold text-purple-600">{{ callGraphStats.entry_points }}</div>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600">Layers</div>
                                        <div class="text-2xl font-bold text-orange-600">{{ Object.keys(callGraphStats.layers || {}).length }}</div>
                                    </div>
                                </div>

                                <!-- Layers Distribution -->
                                <div v-if="callGraphStats.layers && Object.keys(callGraphStats.layers).length > 0">
                                    <h4 class="font-semibold text-gray-800 mb-3">üìä Architectural Layers</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div v-for="(count, layer) in callGraphStats.layers" :key="layer"
                                             class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
                                            <span class="text-gray-700 font-medium">{{ layer }}</span>
                                            <span class="font-bold text-gray-900">{{ count }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Entry Points -->
                                <div v-if="entryPoints.length > 0">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-semibold text-gray-800">‚ö° Entry Points ({{ entryPoints.length }})</h4>
                                    </div>
                                    <div class="space-y-2 max-h-64 overflow-y-auto">
                                        <div v-for="ep in entryPoints" :key="ep.function_id"
                                             @click="showFunctionDetails(ep.function_id)"
                                             class="bg-white border rounded-lg p-4 hover:border-blue-500 cursor-pointer transition">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="font-mono font-semibold text-gray-900">{{ ep.function_name }}</div>
                                                    <div class="text-sm text-gray-600 mt-1 truncate">{{ ep.file_path }}</div>
                                                </div>
                                                <div class="flex gap-2 ml-4">
                                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded whitespace-nowrap">
                                                        {{ ep.trigger_type || 'function' }}
                                                    </span>
                                                    <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded whitespace-nowrap">
                                                        {{ ep.layer || 'unknown' }}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Functions List -->
                                <div>
                                    <h4 class="font-semibold text-gray-800 mb-3">üîß Functions</h4>

                                    <!-- Filters -->
                                    <div class="flex gap-3 mb-4 flex-wrap">
                                        <select v-model="callGraphFilter.layer" @change="loadCallGraphFunctions"
                                                class="px-3 py-2 border rounded-lg text-sm">
                                            <option value="">All Layers</option>
                                            <option v-for="(count, layer) in callGraphStats.layers" :key="layer" :value="layer">
                                                {{ layer }} ({{ count }})
                                            </option>
                                        </select>
                                        <select v-model="callGraphFilter.triggerType" @change="loadCallGraphFunctions"
                                                class="px-3 py-2 border rounded-lg text-sm">
                                            <option value="">All Triggers</option>
                                            <option v-for="(count, trigger) in callGraphStats.trigger_types" :key="trigger" :value="trigger">
                                                {{ trigger }} ({{ count }})
                                            </option>
                                        </select>
                                        <label class="flex items-center gap-2 px-3 py-2 border rounded-lg text-sm cursor-pointer hover:bg-gray-50">
                                            <input type="checkbox" v-model="callGraphFilter.entryPointsOnly" @change="loadCallGraphFunctions" class="rounded">
                                            <span>Entry Points Only</span>
                                        </label>
                                    </div>

                                    <!-- Functions -->
                                    <div v-if="callGraphFunctions.length > 0" class="space-y-2 max-h-96 overflow-y-auto">
                                        <div v-for="func in callGraphFunctions" :key="func.id"
                                             @click="showFunctionDetails(func.id)"
                                             class="bg-white border rounded-lg p-3 hover:border-blue-500 cursor-pointer transition">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="font-mono font-medium text-gray-900">
                                                        {{ func.name }}
                                                        <span v-if="func.is_entry_point" class="ml-2 text-xs text-green-600">‚ö°</span>
                                                    </div>
                                                    <div class="text-xs text-gray-500 mt-1 truncate">{{ func.file_path }}:{{ func.line_number }}</div>
                                                    <div v-if="func.description" class="text-sm text-gray-600 mt-1 line-clamp-2">{{ func.description }}</div>
                                                </div>
                                                <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded ml-4 whitespace-nowrap">
                                                    {{ func.layer }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="text-center py-8 text-gray-500">
                                        –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                                    </div>
                                </div>
                            </div>

                            <!-- No Call Graph Data -->
                            <div v-else class="text-center py-12">
                                <div class="text-gray-400 text-6xl mb-4">üìä</div>
                                <p class="text-gray-600 mb-2">Call graph –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>
                                <p class="text-sm text-gray-500">–ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é index_project_with_call_graph</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- File Content Modal -->
        <div v-if="selectedFile" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" @click="selectedFile = null">
            <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto" @click.stop>
                <div class="p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
                    <div class="flex items-center justify-between">
                        <div class="flex-1 min-w-0">
                            <h3 class="text-xl font-bold text-gray-800 font-mono truncate">{{ selectedFile.file_path }}</h3>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded">
                                    {{ selectedFile.language }}
                                </span>
                                <span :class="getFileTypeColor(selectedFile.file_type)" class="px-2 py-1 text-xs rounded">
                                    {{ selectedFile.file_type }}
                                </span>
                                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded">
                                    {{ selectedFile.total_chunks }} {{ selectedFile.total_chunks === 1 ? '—á–∞–Ω–∫' : '—á–∞–Ω–∫–∞' }}
                                </span>
                            </div>
                        </div>
                        <button @click="selectedFile = null" class="text-gray-400 hover:text-gray-600 text-2xl ml-4">√ó</button>
                    </div>
                </div>

                <!-- Loading -->
                <div v-if="loadingFileContent" class="p-12 text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="text-gray-500 mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ...</p>
                </div>

                <!-- Content -->
                <div v-else class="p-6">
                    <div v-if="fileChunks.length === 0" class="text-center py-8 text-gray-500">
                        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                    </div>

                    <div v-else class="space-y-6">
                        <!-- Chunk -->
                        <div
                            v-for="chunk in fileChunks"
                            :key="chunk.chunk_index"
                            class="border border-gray-200 rounded-lg overflow-hidden"
                        >
                            <!-- Chunk Header -->
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <span class="font-semibold text-gray-700">
                                            –ß–∞–Ω–∫ {{ chunk.chunk_index + 1 }} / {{ chunk.total_chunks }}
                                        </span>
                                        <span v-if="chunk.purpose" class="text-sm text-gray-600">
                                            {{ chunk.purpose }}
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button
                                            @click="copyToClipboard(chunk.content)"
                                            class="px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-gray-50"
                                        >
                                            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                        </button>
                                    </div>
                                </div>

                                <!-- Metadata -->
                                <div v-if="chunk.dependencies.length > 0 || chunk.exported_symbols.length > 0" class="mt-3 space-y-2">
                                    <div v-if="chunk.dependencies.length > 0" class="flex items-start gap-2">
                                        <span class="text-xs font-medium text-gray-600">–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:</span>
                                        <div class="flex flex-wrap gap-1">
                                            <span
                                                v-for="dep in chunk.dependencies"
                                                :key="dep"
                                                class="px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 rounded"
                                            >
                                                {{ dep }}
                                            </span>
                                        </div>
                                    </div>
                                    <div v-if="chunk.exported_symbols.length > 0" class="flex items-start gap-2">
                                        <span class="text-xs font-medium text-gray-600">–≠–∫—Å–ø–æ—Ä—Ç—ã:</span>
                                        <div class="flex flex-wrap gap-1">
                                            <span
                                                v-for="symbol in chunk.exported_symbols"
                                                :key="symbol"
                                                class="px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded font-mono"
                                            >
                                                {{ symbol }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Code Content -->
                            <div class="bg-gray-900">
                                <pre class="p-4 overflow-x-auto"><code class="text-sm text-gray-100 font-mono whitespace-pre">{{ chunk.content }}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div v-if="confirmModal.show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" @click="confirmModal.show = false">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full" @click.stop>
                <div class="p-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="text-3xl">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-bold text-gray-800">{{ confirmModal.title }}</h3>
                    </div>
                    <p class="text-gray-600 mb-6">{{ confirmModal.message }}</p>
                    <div class="flex gap-3 justify-end">
                        <button
                            @click="confirmModal.show = false"
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
                        >
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button
                            @click="confirmModal.onConfirm"
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                        >
                            {{ confirmModal.confirmText }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div v-if="notification.show" class="fixed top-4 right-4 z-50 animate-fade-in">
            <div
                :class="notification.type === 'success' ? 'bg-green-600' : notification.type === 'error' ? 'bg-red-600' : 'bg-blue-600'"
                class="text-white px-6 py-4 rounded-lg shadow-lg max-w-md"
            >
                <div class="flex items-center gap-3">
                    <span class="text-2xl">
                        {{ notification.type === 'success' ? '‚úÖ' : notification.type === 'error' ? '‚ùå' : '‚ÑπÔ∏è' }}
                    </span>
                    <div class="flex-1">
                        <div class="font-semibold">{{ notification.title }}</div>
                        <div v-if="notification.message" class="text-sm opacity-90 mt-1">{{ notification.message }}</div>
                    </div>
                    <button @click="notification.show = false" class="text-white opacity-75 hover:opacity-100">√ó</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-white border-t mt-12">
            <div class="container mx-auto px-4 py-6">
                <div class="flex justify-between items-center">
                    <p class="text-gray-600">Project Indexer Admin v1.0.0</p>
                    <div class="flex gap-4 text-sm text-gray-600">
                        <a href="/api/health" target="_blank" class="hover:text-blue-600">API Health</a>
                        <a href="/api/projects" target="_blank" class="hover:text-blue-600">API Projects</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    projects: [],
                    loading: true,
                    serverStatus: 'üü¢',
                    totalProjects: 0,
                    totalFiles: 0,
                    selectedProject: null,
                    currentTab: 'info',
                    projectFiles: [],
                    loadingFiles: false,
                    fileSearchQuery: '',
                    selectedFile: null,
                    fileChunks: [],
                    loadingFileContent: false,
                    // Global search
                    globalSearchQuery: '',
                    searchProjectPath: '',
                    searchResults: [],
                    globalSearching: false,
                    searchPerformed: false,
                    lastSearchQuery: '',
                    confirmModal: {
                        show: false,
                        title: '',
                        message: '',
                        confirmText: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
                        onConfirm: null
                    },
                    notification: {
                        show: false,
                        type: 'info', // success, error, info
                        title: '',
                        message: ''
                    },
                    // Call Graph
                    callGraphStats: null,
                    entryPoints: [],
                    callGraphFunctions: [],
                    callGraphFilter: {
                        layer: '',
                        triggerType: '',
                        entryPointsOnly: false
                    },
                    loadingCallGraph: false,
                    selectedFunction: null
                };
            },
            computed: {
                filteredFiles() {
                    if (!this.fileSearchQuery) return this.projectFiles;

                    const query = this.fileSearchQuery.toLowerCase();
                    return this.projectFiles.filter(file =>
                        file.relative_path.toLowerCase().includes(query)
                    );
                }
            },
            watch: {
                currentTab(newTab) {
                    if (newTab === 'files' && this.projectFiles.length === 0 && this.selectedProject) {
                        this.loadProjectFiles();
                    }
                }
            },
            mounted() {
                this.loadProjects();
            },
            methods: {
                async loadProjects() {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/projects');
                        const data = await response.json();

                        this.projects = data.projects;
                        this.totalProjects = data.total;
                        this.totalFiles = data.projects.reduce((sum, p) => sum + p.total_files, 0);
                        this.serverStatus = 'üü¢';
                    } catch (error) {
                        console.error('Failed to load projects:', error);
                        this.serverStatus = 'üî¥';
                    } finally {
                        this.loading = false;
                    }
                },
                selectProject(project) {
                    this.selectedProject = project;
                    this.currentTab = 'info';
                    this.projectFiles = [];
                    this.fileSearchQuery = '';
                },
                async loadProjectFiles() {
                    if (!this.selectedProject) return;

                    this.loadingFiles = true;
                    try {
                        const encodedPath = encodeURIComponent(this.selectedProject.project_path);
                        const response = await fetch(`/api/projects/${encodedPath}/files?limit=10000`);
                        const data = await response.json();

                        this.projectFiles = data.files || [];
                    } catch (error) {
                        console.error('Failed to load files:', error);
                        this.projectFiles = [];
                    } finally {
                        this.loadingFiles = false;
                    }
                },
                async viewFileContent(file) {
                    this.selectedFile = {
                        file_path: file.relative_path,
                        language: file.language,
                        file_type: file.file_type,
                        total_chunks: file.chunks
                    };
                    this.loadingFileContent = true;
                    this.fileChunks = [];

                    try {
                        const encodedProjectPath = encodeURIComponent(this.selectedProject.project_path);
                        const encodedFilePath = encodeURIComponent(file.relative_path);
                        const response = await fetch(`/api/projects/${encodedProjectPath}/files/${encodedFilePath}`);
                        const data = await response.json();

                        if (data.status === 'success') {
                            this.fileChunks = data.chunks;
                        } else {
                            console.error('Failed to load file content:', data);
                        }
                    } catch (error) {
                        console.error('Failed to load file content:', error);
                    } finally {
                        this.loadingFileContent = false;
                    }
                },
                async copyToClipboard(text) {
                    try {
                        await navigator.clipboard.writeText(text);
                        this.showNotification('success', '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', '–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                    } catch (error) {
                        console.error('Failed to copy:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                    }
                },
                confirmDeleteProject() {
                    this.confirmModal = {
                        show: true,
                        title: '–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?',
                        message: `–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${this.selectedProject.project_name}" –∏–∑ –∏–Ω–¥–µ–∫—Å–∞? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.`,
                        confirmText: '–£–¥–∞–ª–∏—Ç—å',
                        onConfirm: () => this.deleteProject()
                    };
                },
                async deleteProject() {
                    this.confirmModal.show = false;

                    const projectPath = this.selectedProject.project_path;
                    const projectName = this.selectedProject.project_name;

                    try {
                        const encodedPath = encodeURIComponent(projectPath);
                        const response = await fetch(`/api/projects/${encodedPath}`, {
                            method: 'DELETE'
                        });
                        const data = await response.json();

                        if (data.status === 'success') {
                            this.showNotification('success', '–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª–µ–Ω', `"${projectName}" —É–¥–∞–ª–µ–Ω –∏–∑ –∏–Ω–¥–µ–∫—Å–∞`);
                            this.selectedProject = null;
                            // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
                            await this.loadProjects();
                        } else {
                            this.showNotification('error', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                        }
                    } catch (error) {
                        console.error('Failed to delete project:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', error.message);
                    }
                },
                async updateFileIndex(file) {
                    // Set updating flag
                    file.updating = true;

                    try {
                        const encodedPath = encodeURIComponent(this.selectedProject.project_path);
                        const response = await fetch(`/api/projects/${encodedPath}/files/update`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                file_paths: [file.relative_path]
                            })
                        });
                        const data = await response.json();

                        if (data.status === 'success' || data.status === 'partial') {
                            const stats = data.stats;
                            if (stats.updated_files > 0) {
                                this.showNotification(
                                    'success',
                                    '–ò–Ω–¥–µ–∫—Å –æ–±–Ω–æ–≤–ª–µ–Ω',
                                    `–§–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω: ${stats.total_chunks} —á–∞–Ω–∫–æ–≤`
                                );
                                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                                await this.loadProjectFiles();
                            } else if (stats.failed_files > 0) {
                                this.showNotification('error', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', data.errors?.[0]?.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª');
                            }
                        } else {
                            this.showNotification('error', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                        }
                    } catch (error) {
                        console.error('Failed to update file:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', error.message);
                    } finally {
                        file.updating = false;
                    }
                },
                showNotification(type, title, message = '') {
                    this.notification = {
                        show: true,
                        type,
                        title,
                        message
                    };

                    // Auto-hide after 5 seconds
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 5000);
                },
                getFileTypeColor(fileType) {
                    const colors = {
                        'code': 'bg-purple-100 text-purple-700',
                        'documentation': 'bg-blue-100 text-blue-700',
                        'config': 'bg-yellow-100 text-yellow-700',
                        'test': 'bg-green-100 text-green-700',
                        'unknown': 'bg-gray-100 text-gray-700'
                    };
                    return colors[fileType] || colors['unknown'];
                },
                formatDate(timestamp) {
                    if (!timestamp) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    const date = new Date(timestamp * 1000);
                    return date.toLocaleDateString('ru-RU', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                async performGlobalSearch() {
                    if (!this.globalSearchQuery.trim()) return;

                    this.globalSearching = true;
                    this.searchPerformed = true;
                    this.lastSearchQuery = this.globalSearchQuery;
                    this.searchResults = [];

                    try {
                        // Search in specific project or all projects
                        if (this.searchProjectPath) {
                            // Search in specific project
                            const results = await this.searchInProject(this.searchProjectPath, this.globalSearchQuery);
                            this.searchResults = results;
                        } else {
                            // Search in all projects
                            const allResults = [];
                            for (const project of this.projects) {
                                const results = await this.searchInProject(project.project_path, this.globalSearchQuery);
                                allResults.push(...results);
                            }
                            // Sort by score descending
                            allResults.sort((a, b) => b.score - a.score);
                            this.searchResults = allResults.slice(0, 20); // Top 20 results
                        }

                        if (this.searchResults.length > 0) {
                            this.showNotification('success', '–ù–∞–π–¥–µ–Ω–æ', `${this.searchResults.length} —Ñ–∞–π–ª–æ–≤`);
                        } else {
                            this.showNotification('info', '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å');
                        }
                    } catch (error) {
                        console.error('Search failed:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞', error.message);
                    } finally {
                        this.globalSearching = false;
                    }
                },
                async searchInProject(projectPath, query) {
                    try {
                        const encodedPath = encodeURIComponent(projectPath);
                        const response = await fetch(`/api/projects/${encodedPath}/search?query=${encodeURIComponent(query)}&n_results=10`);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        const data = await response.json();

                        if (data.status === 'success') {
                            // Add project info to each result
                            return data.results.map(result => ({
                                ...result,
                                project_path: projectPath,
                                project_name: this.projects.find(p => p.project_path === projectPath)?.project_name || projectPath
                            }));
                        }
                        return [];
                    } catch (error) {
                        console.error(`Search failed for project ${projectPath}:`, error);
                        return [];
                    }
                },
                clearSearch() {
                    this.searchResults = [];
                    this.globalSearchQuery = '';
                    this.searchPerformed = false;
                    this.lastSearchQuery = '';
                },
                async openSearchResult(result) {
                    // Find and open the project
                    const project = this.projects.find(p => p.project_path === result.project_path);
                    if (!project) {
                        this.showNotification('error', '–û—à–∏–±–∫–∞', '–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }

                    // Select the project
                    this.selectProject(project);

                    // Switch to files tab
                    this.currentTab = 'files';

                    // Load files if not loaded
                    if (this.projectFiles.length === 0) {
                        await this.loadProjectFiles();
                    }

                    // Find and open the file
                    const file = this.projectFiles.find(f => f.relative_path === result.relative_path);
                    if (file) {
                        await this.viewFileContent(file);
                    } else {
                        this.showNotification('info', '–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω', '–í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª –±—ã–ª —É–¥–∞–ª–µ–Ω');
                    }
                },

                // Call Graph Methods
                async loadCallGraphData() {
                    if (!this.selectedProject || this.loadingCallGraph) return;

                    this.loadingCallGraph = true;
                    this.callGraphStats = null;
                    this.entryPoints = [];
                    this.callGraphFunctions = [];

                    try {
                        const encodedPath = encodeURIComponent(this.selectedProject.project_path);

                        // Load stats
                        const statsResponse = await fetch(`/api/projects/${encodedPath}/call-graph/stats`);
                        if (statsResponse.ok) {
                            const statsData = await statsResponse.json();
                            this.callGraphStats = statsData.stats;
                        }

                        // Load entry points
                        const epResponse = await fetch(`/api/projects/${encodedPath}/call-graph/entry-points`);
                        if (epResponse.ok) {
                            const epData = await epResponse.json();
                            this.entryPoints = epData.entry_points;
                        }

                        // Load functions
                        await this.loadCallGraphFunctions();

                    } catch (error) {
                        console.error('Failed to load call graph data:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å call graph –¥–∞–Ω–Ω—ã–µ');
                    } finally {
                        this.loadingCallGraph = false;
                    }
                },

                async loadCallGraphFunctions() {
                    if (!this.selectedProject) return;

                    try {
                        const encodedPath = encodeURIComponent(this.selectedProject.project_path);
                        const params = new URLSearchParams();

                        if (this.callGraphFilter.layer) {
                            params.append('layer', this.callGraphFilter.layer);
                        }
                        if (this.callGraphFilter.triggerType) {
                            params.append('trigger_type', this.callGraphFilter.triggerType);
                        }
                        if (this.callGraphFilter.entryPointsOnly) {
                            params.append('entry_points_only', 'true');
                        }

                        const response = await fetch(`/api/projects/${encodedPath}/call-graph/functions?${params}`);
                        if (response.ok) {
                            const data = await response.json();
                            this.callGraphFunctions = data.functions;
                        }
                    } catch (error) {
                        console.error('Failed to load call graph functions:', error);
                    }
                },

                async showFunctionDetails(functionId) {
                    if (!this.selectedProject) return;

                    try {
                        const encodedPath = encodeURIComponent(this.selectedProject.project_path);
                        const response = await fetch(`/api/projects/${encodedPath}/call-graph/functions/${functionId}`);

                        if (response.ok) {
                            const data = await response.json();
                            this.selectedFunction = data;

                            // Format details for display
                            const func = data.function;
                            const calls = data.calls || [];
                            const callers = data.callers || [];

                            let message = `Function: ${func.name}\n`;
                            message += `File: ${func.file_path}:${func.line_number}\n`;
                            message += `Layer: ${func.layer || 'unknown'}\n\n`;

                            if (func.description) {
                                message += `Description: ${func.description}\n\n`;
                            }

                            message += `Calls (${calls.length}):\n`;
                            calls.slice(0, 5).forEach(call => {
                                message += `  ‚Üí ${call.callee_name}`;
                                if (call.target_name) {
                                    message += ` (${call.target_name})`;
                                }
                                message += `\n`;
                            });
                            if (calls.length > 5) {
                                message += `  ... –∏ –µ—â–µ ${calls.length - 5}\n`;
                            }

                            message += `\nCalled by (${callers.length}):\n`;
                            callers.slice(0, 5).forEach(caller => {
                                message += `  ‚Üê ${caller.caller_name}\n`;
                            });
                            if (callers.length > 5) {
                                message += `  ... –∏ –µ—â–µ ${callers.length - 5}\n`;
                            }

                            // Show modal or alert
                            alert(message);
                        }
                    } catch (error) {
                        console.error('Failed to load function details:', error);
                        this.showNotification('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏');
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
